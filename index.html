<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Task Tickler</title>

<link rel="manifest" href="manifest.webmanifest" />
<meta name="theme-color" content="#0a84ff" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />

<style>
  :root { --pad:16px; --radius:12px; --muted:#6b7280; }
  body { font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; margin:0; background:#f7f7f9; color:#111; }
  header { position:sticky; top:0; background:white; padding:12px var(--pad); border-bottom:1px solid #eee; display:flex; gap:12px; align-items:center; }
  header h1 { font-size:18px; margin:0; flex:1; }
  #viewTabs { display:flex; gap:8px; }
  #viewTabs button { border:1px solid #ddd; background:#fff; border-radius:999px; padding:6px 10px; }
  #viewTabs button.active { border-color:#0a84ff; }
  main { padding: var(--pad); }
  form#newTask { display:grid; gap:8px; grid-template-columns:1fr 150px; background:white; padding:12px; border-radius:var(--radius); border:1px solid #eee; }
  form#newTask input, form#newTask button, form#newTask select { font:inherit; padding:10px; border:1px solid #ddd; border-radius:8px; }
  form#newTask button { background:#0a84ff; color:#fff; border:none; }
  .row { background:#fff; border:1px solid #eee; border-radius:var(--radius); padding:12px; display:grid; grid-template-columns: 24px 1fr auto; gap:10px; align-items:center; }
  .row + .row { margin-top:8px; }
  .title { font-weight:600; }
  .meta { color:var(--muted); font-size:13px; }
  .actions button { border:1px solid #ddd; background:#fff; border-radius:999px; padding:6px 10px; margin-left:6px; }
  .section { margin-top:18px; }
  .empty { color:var(--muted); text-align:center; padding:20px 0; }
  footer { padding:16px; color:var(--muted); text-align:center; font-size:12px; }
</style>
</head>
<body>
<header>
  <h1>Task Tickler</h1>
  <div id="viewTabs">
    <button data-view="today" class="active">Today</button>
    <button data-view="upcoming">Upcoming</button>
    <button data-view="all">All</button>
  </div>
</header>

<main>
  <form id="newTask" autocomplete="off">
    <input id="title" placeholder="e.g., Email Sandra about API limit" required />
    <input id="date" type="date" required />
    <button type="submit">Add</button>
  </form>

  <div class="section" id="list"></div>
</main>

<footer>
  Tip: Tap a task‚Äôs ‚Ä¢‚Ä¢‚Ä¢ to Snooze +1d/+1w/+1m. Long-press Add to Home Screen for an ‚Äúapp‚Äù feel.
</footer>

<script>
const storeKey = "tickler.v1";
let tasks = load();

function load(){ try { return JSON.parse(localStorage.getItem(storeKey)) || []; } catch { return []; } }
function save(){ localStorage.setItem(storeKey, JSON.stringify(tasks)); }

function uid(){ return Math.random().toString(36).slice(2,9); }
function todayStr(){
  const d = new Date(); d.setHours(0,0,0,0);
  return d.toISOString().slice(0,10);
}
function addDays(iso, n){
  const d = new Date(iso+"T00:00:00"); d.setDate(d.getDate()+n);
  return d.toISOString().slice(0,10);
}

function addTask(title, due){
  tasks.push({ id: uid(), title: title.trim(), due, done:false, created: new Date().toISOString() });
  save(); render();
}
function toggleDone(id){
  const t = tasks.find(x=>x.id===id);
  if(!t) return; t.done = !t.done; save(); render();
}
function removeTask(id){
  tasks = tasks.filter(x=>x.id!==id); save(); render();
}
function snooze(id, days){
  const t = tasks.find(x=>x.id===id); if(!t) return;
  t.due = addDays(t.due || todayStr(), days); t.done=false;
  save(); render();
}

const listEl = document.getElementById("list");
const tabs = [...document.querySelectorAll("#viewTabs button")];
let currentView = "today";
tabs.forEach(b=>b.addEventListener("click", ()=>{
  tabs.forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
  currentView = b.dataset.view; render();
}));

function render(){
  const tdy = todayStr();
  const sorted = [...tasks].sort((a,b)=> (a.due||"9999") < (b.due||"9999") ? -1 : (a.due||"9999") > (b.due||"9999") ? 1 : a.title.localeCompare(b.title));
  let filtered = sorted;
  if(currentView==="today"){ filtered = sorted.filter(t => (t.due||tdy) <= tdy && !t.done); }
  if(currentView==="upcoming"){ filtered = sorted.filter(t => (t.due||"") > tdy && !t.done); }
  if(currentView==="all"){ filtered = sorted; }

  if(!filtered.length){
    listEl.innerHTML = `<div class="empty">Nothing here. Add something above.</div>`;
    return;
  }

  listEl.innerHTML = filtered.map(t=>{
    const dueTxt = t.due ? t.due : "no date";
    const status = t.done ? "‚úÖ Done" : (t.due && t.due < tdy ? "‚è∞ Overdue" : (t.due === tdy ? "üìå Today" : "üìÖ Upcoming"));
    return `
      <div class="row" data-id="${t.id}">
        <input type="checkbox" ${t.done?"checked":""} aria-label="done" />
        <div>
          <div class="title" style="${t.done?'text-decoration:line-through;color:#9ca3af':''}">${escapeHtml(t.title)}</div>
          <div class="meta">${status} ‚Ä¢ due ${dueTxt}</div>
        </div>
        <div class="actions">
          <button class="more" aria-label="more">‚Ä¢‚Ä¢‚Ä¢</button>
        </div>
      </div>
    `;
  }).join("");

  // wire events
  listEl.querySelectorAll(".row input[type=checkbox]").forEach(cb=>{
    cb.addEventListener("change", (e)=>{
      const id = e.target.closest(".row").dataset.id;
      toggleDone(id);
    });
  });
  listEl.querySelectorAll(".row .more").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      const row = e.target.closest(".row");
      const id = row.dataset.id;
      quickMenu(e.target, [
        ["Snooze +1 day", ()=>snooze(id,1)],
        ["Snooze +1 week", ()=>snooze(id,7)],
        ["Snooze +1 month", ()=>snooze(id,30)],
        ["Edit title", ()=>editTitle(id)],
        ["Set date to Today", ()=>{ const t=tasks.find(x=>x.id===id); t.due=todayStr(); save(); render(); }],
        ["Remove", ()=>removeTask(id)]
      ]);
    });
  });
}

function editTitle(id){
  const t = tasks.find(x=>x.id===id); if(!t) return;
  const v = prompt("Edit task", t.title);
  if(v!=null && v.trim()){ t.title = v.trim(); save(); render(); }
}

function quickMenu(anchor, items){
  const menu = document.createElement("div");
  Object.assign(menu.style, {
    position:"fixed", right:"16px", top:(anchor.getBoundingClientRect().bottom+8)+"px",
    background:"#fff", border:"1px solid #eee", borderRadius:"10px", padding:"6px", zIndex:9999, boxShadow:"0 10px 20px rgba(0,0,0,0.08)"
  });
  menu.innerHTML = items.map(([label],i)=>`<button data-i="${i}" style="display:block;width:100%;text-align:left;border:0;background:#fff;padding:10px 12px;border-radius:8px">${label}</button>`).join("");
  document.body.appendChild(menu);
  function close(){ menu.remove(); document.removeEventListener("click", close, {capture:true}); }
  setTimeout(()=>document.addEventListener("click", close, {capture:true}),0);
  menu.querySelectorAll("button").forEach(b=>b.addEventListener("click",(e)=>{ items[b.dataset.i][1](); close(); }));
}

function escapeHtml(s){ return s.replace(/[&<>"]/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[c])); }

// Add form
const form = document.getElementById("newTask");
const title = document.getElementById("title");
const date = document.getElementById("date");
form.addEventListener("submit", (e)=>{
  e.preventDefault();
  addTask(title.value, date.value || todayStr());
  title.value=""; date.value="";
  title.focus();
});

// register SW
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./sw.js");
}

render();
</script>
</body>
</html>
